define(["./module","leaflet","jquery"],function(a,b,c){"use strict";a.directive("map",[function(){var a={restrict:"C",replace:!1,transclude:!0,link:function(a,d){var e=d[0],f=new b.Map(e,{attributionControl:!0,zoomControl:!1});b.control.scale({imperial:!1}).addTo(f);var g="http://{s}.tile3.opencyclemap.org/landscape/{z}/{x}/{y}.png";b.tileLayer(g,{attribution:"&copy; OpenStreetMap"}).addTo(f);var h={};a.displayed_trails=0,a.cached_trails=0,a.$watch("trails",function(d){a.displayed_trails=0,d&&c.each(d,function(c,e){if(a.displayed_trails=d.length,!(e.id in h)){var g=b.geoJson(e.path,{color:"blue"});delete e.path,g.on("click",function(){a.selectedTrail=e,a.$apply()}),h[e.id]={trail:e,layer:g},g.addTo(f),a.cached_trails||(a.cached_trails=0),a.cached_trails++}})}),a.$watch("selectedTrail",function(a,b){if(b&&b.id&&h[b.id].layer.setStyle({color:"blue"}),a&&a.id){var c=h[a.id],d=c.layer;if(d){d.bringToFront(),d.setStyle({color:"red"});var e=d.getBounds(),g=f.getBoundsZoom(e);f.setView(e.getCenter(),g-2)}}}),a.$watch("center",function(c){if(void 0!==c){c=new b.LatLng(a.center[1],a.center[0]);var d=a.zoom||13;f.setView(c,d)}}),f.on("move",function(){a.$emit("newBounds",f.getBounds())})}};return a}])});